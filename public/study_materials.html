<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ChemGuide | Study Materials</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="icon" href="assets/images/logo.png" type="image/x-icon">
</head>
<body>
  <!-- ðŸ”¹ Header -->
  <header>
    <nav class="navbar">
      <div class="logo">
        <img src="assets/images/logo.png" alt="ChemGuide Logo">
        <span>ChemGuide</span>
      </div>
      <!-- Hamburger menu -->
      <span class="menu-toggle" id="menu-toggle">&#9776;</span>
      <ul class="nav-links" id="nav-links">
        <li><a href="index.html" class="active">Home</a></li>
        <li><a href="study_materials.html">Study Materials</a></li>
        <li><a href="online_test.html">Online Test</a></li>
        <li><a href="login.html">Account</a></li>
      </ul>
    </nav>
  </header>

  <!-- ðŸ”¹ Hero Section -->
  <section class="hero" style="background-image: url('assets/images/bg_materials.jpg');">
    <div class="hero-content">
      <h1>ðŸ“š Study Materials</h1>
      <p>Select your exam category or tag to view/download notes and guides.</p>
      <a href="#materials-section" class="btn">View Materials</a>
    </div>
  </section>

  <!-- ðŸ”¹ Filters & Sort -->
  <section class="materials-container">
    <div class="filter-sort-container">
      <label>Category:</label>
      <select id="category-filter">
        <option value="">All</option>
        <option value="PGTRB">PGTRB</option>
        <option value="Polytechnic TRB">Polytechnic TRB</option>
        <option value="Arts & Science TRB">Arts & Science TRB</option>
        <option value="SET">SET</option>
      </select>

      <label>Tag:</label>
      <input type="text" id="tag-filter" placeholder="e.g. Organic">

      <label>Sort by:</label>
      <select id="sort-filter">
        <option value="">Default</option>
        <option value="title">Title</option>
        <option value="category">Category</option>
        <option value="tag">Tag</option>
      </select>

      <button onclick="loadMaterials()">Apply</button>
    </div>

    <!-- ðŸ”¹ Materials Grid -->
    <div id="materials-grid" class="materials-grid">
      <!-- Materials will be loaded dynamically here -->
    </div>
  </section>

  <!-- ðŸ”¹ Footer -->
  <footer>
    <p>Â© 2025 ChemGuide. All rights reserved.</p>
  </footer>

  <!-- ðŸ”¹ JS -->
  <script>
    async function loadMaterials() {
      const category = document.getElementById('category-filter').value;
      const tag = document.getElementById('tag-filter').value;
      const sort = document.getElementById('sort-filter').value;

      let url = '/api/materials';
      const params = new URLSearchParams();
      if(category) params.append('category', category);
      if(tag) params.append('tag', tag);
      if(sort) params.append('sort', sort);
      if([...params].length) url += '?' + params.toString();

      const grid = document.getElementById('materials-grid');
      grid.innerHTML = '<p>Loading materials...</p>';

      try {
        const res = await fetch(url);
        const data = await res.json();

        grid.innerHTML = '';
        if(data.length === 0) {
          grid.innerHTML = '<p>No materials found.</p>';
          return;
        }

        // Group by category
        const grouped = {};
        data.forEach(mat => {
          if(!grouped[mat.category]) grouped[mat.category] = [];
          grouped[mat.category].push(mat);
        });

        // Render materials
        for(const category in grouped) {
          const categoryDiv = document.createElement('div');
          categoryDiv.className = 'material-card';
          const categoryTitle = document.createElement('h3');
          categoryTitle.textContent = category;
          categoryDiv.appendChild(categoryTitle);

          const ul = document.createElement('ul');
          grouped[category].forEach(mat => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = mat.file_path;
            a.target = '_blank';
            a.textContent = mat.title;
            if(mat.tag) {
              const span = document.createElement('span');
              span.className = 'tag';
              span.textContent = ` - ${mat.tag}`;
              a.appendChild(span);
            }
            li.appendChild(a);
            ul.appendChild(li);
          });

          categoryDiv.appendChild(ul);
          grid.appendChild(categoryDiv);
        }
      } catch (err) {
        console.error(err);
        grid.innerHTML = '<p>Error loading materials.</p>';
      }
    }

    // âœ… Mobile menu toggle
    const menuToggle = document.getElementById("menu-toggle");
    const navLinks = document.getElementById("nav-links");

    menuToggle.addEventListener("click", () => {
      navLinks.classList.toggle("show");
    });

    // Initial load
    loadMaterials();
  </script>
</body>
</html>
